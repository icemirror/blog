# å˜é‡å£°æ˜(var, let, const)

### è¯¾ç¨‹å†…å®¹

- var
- let
- const
- let vs const
- è§£æ„
- å±•å¼€

### var

```js
function f() {
  var a = 10
  return function g() {
    return a + 1 // äº§ç”Ÿé—­åŒ…: å‡½æ•°å¯¹çˆ¶çº§ä½œç”¨åŸŸå†…çš„å˜é‡æœ‰å¼•ç”¨å…³ç³»
  }
}
var g = f()
g() // 11
```

```js
function f(shouldBeInitialized) {
  if (shouldBeInitialized) {
    var x = 10
  }
  return x
}
f(true) // 10
f(false) // undefined
```
è¿™é‡Œæ¶‰åŠåˆ°varå˜é‡å£°æ˜è¢«æå‡çš„é—®é¢˜. ä¸Šé¢çš„ä¾‹å­ä¸­varå˜é‡x, å…¶å£°æ˜ä¼šè¢«æå‡åˆ°å‡½æ•°çš„é¡¶éƒ¨, ä¸Šé¢çš„få‡½æ•°ç­‰ä»·äº:

```js
function f(shouldBeInitialized) {
  var x
  if (shouldBeInitialized) {
    x = 10
  }
  return x
}
```

å½“```shouldBeInitialized```ä¸º```false```æ—¶, xä»…è¢«å£°æ˜, è€Œæ²¡æœ‰è¢«åˆå§‹åŒ–èµ‹å€¼, å› æ­¤è·å–xçš„å€¼é»˜è®¤ä¸º```undefined```.

```js
function sumMatrix(matrix) {
  var sum = 0;
  for(var i = 0; i < matrix.length; i++) {
    var currentRow = matrix[i];
    for(var i = 0; i < currentRow.length; i++) { // ç¨‹åºé”™è¯¯, å†…å±‚çš„iä¼šè¦†ç›–å¤–å±‚çš„i
      sum += currentRow[i];
    }
  }
  return sum;
}

console.log(sumMatrix([[1, 2], [3, 4]])); // 3 = 1 + 2
```
ç¨‹åºè¾“å‡ºéé¢„æœŸçš„10, è€Œæ˜¯3, ç¬¬ä¸€å±‚å¾ªç¯æ—¶, currentRow = matrix[0] = [1, 2], å½“å†…å±‚å¾ªç¯ç»“æŸæ—¶, sum = 1 + 2 = 3, è€Œæ­¤æ—¶iè¢«æ”¹ä¸º2, æ­¤æ—¶ä¼šé€€å‡ºå¤–å±‚å¾ªç¯, ä»è€Œè¾“å‡º3.

```js
// è§£å†³åŠæ³•
function sumMatrix(matrix) {
  var sum = 0;
  for(var i = 0; i < matrix.length; i++) {
    var currentRow = matrix[i];
    for(var j = 0; j < currentRow.length; j++) { // ç¨‹åºé”™è¯¯, å†…å±‚çš„iä¼šè¦†ç›–å¤–å±‚çš„i
      sum += currentRow[j];
    }
  }
  return sum;
}
```

å…³äºvarçš„ç»å…¸é¢è¯•é¢˜:

```js
for (var i = 1; i <= 5; i++) {
  setTimeout(function timer() {
    console.log(i)
  }, i * 1000)
}
```
å…·ä½“è§£é‡Š, è¯·æŸ¥çœ‹[å¾ªç¯ä¸é—­åŒ…](../basics/javascript-1.md#å¾ªç¯ä¸é—­åŒ…)


### let

```ts 
function f(input: boolean) {
  let a = 100;
  if (input) {
    let b = a + 1;
    return b;
  }
  return b; // cant find name 'b'
}

try {
  throw 'oops! error.';
} catch (e) {
  console.error(e);
}
console.log(e); // cant find name 'e'
```
{} ä¸ºå¯ä»¥çœ‹ä½œä¸€ä¸ªå—çº§ä½œç”¨åŸŸ, letå£°æ˜çš„å˜é‡ä¼šä½œç”¨äºå—çº§ä½œç”¨åŸŸ. ä½œç”¨åŸŸå¤–åˆ™æ— æ³•è®¿é—®åˆ°letå£°æ˜çš„å˜é‡.

```ts
console.log(a); // Block-scoped variable 'a' used before its declaration.

let a = 0;
```

let åœ¨å£°æ˜å˜é‡ä¹‹å‰,å˜é‡å¤„äº'æš‚æ—¶æ€§æ­»åŒº',æ— æ³•å¯¹å…¶è¿›è¡Œè®¿é—®æ“ä½œ,å¦åˆ™æŠ¥é”™.

```ts
function foo() {
  return a;
}

console.log(foo());
let a = 0;
```

```bash
tsc test.ts
node test.js
```

ç¼–è¯‘ç»“æœ:

```js
function foo() {
    return a;
}
console.log(foo()); // es5 var a, aå˜é‡è¢«æå‡, å¯ä»¥åœ¨èµ‹å€¼å‰è¢«è®¿é—®, ä½†ç»“æœæ˜¯undefined
var a = 0;
```
```bash
tsc test.ts --target es2015
node test.js

ReferenceError: a is not defined 
```

ç¼–è¯‘ä¸ºes2015æ—¶, letå˜é‡aåœ¨fooè°ƒç”¨ä¹‹åå£°æ˜, æ‰§è¡Œfooå‡½æ•°æ—¶,è¯•å›¾è®¿é—®å˜é‡a,æ­¤æ—¶aå˜é‡å¤„äº 'æš‚æ—¶æ€§æ­»åŒº', å› æ­¤ä¼šæŠ¥é”™.

```ts
let a = 'a';
let a = 'b'; // Cannot redeclare block-scoped variable 'a'
```
åœ¨åŒä¸€ä¸ªä½œç”¨åŸŸå—ä¸­, letå£°æ˜å˜é‡, ä¸èƒ½é‡å¤å£°æ˜.

å›åˆ°çŸ©é˜µè¿ç®—çš„é‚£ä¸ªbug, ä½¿ç”¨letä¹Ÿå¯ä»¥è§£å†³varå˜é‡iè¢«è¦†ç›–çš„é—®é¢˜:

```ts
function sumMatrix(matrix: number[][]) {
  let sum = 0;
  for(let i = 0; i < matrix.length; i++) {
    let currentRow = matrix[i];
    for(let i = 0; i < currentRow.length; i++) {
      // å†…å±‚çš„iæ„æˆæ–°çš„ä½œç”¨åŸŸå—, ä¸å¤–å±‚çš„iæ˜¯äº’ä¸ç›¸å¹²çš„å˜é‡, å› æ­¤ä¸ä¼šå­˜åœ¨è¢«è¦†ç›–çš„é—®é¢˜
      sum += currentRow[i];
    }
  }
  return sum;
}
```

### const

```ts
const pi = 3.1415926;
```

constå£°æ˜çš„å˜é‡ä¸ºå¸¸é‡, é¡¾åæ€ä¹‰å°±æ˜¯å›ºå®šçš„å€¼,ä¸å¯ä»¥è¢«ä¿®æ”¹ (x, å¹¶ä¸æ˜¯æƒ³è±¡ä¸­çš„é‚£ä¸å¯ä»¥è¢«ä¿®æ”¹.

```ts
const test = {
  name: 'lily',
  age: 18,
};

test.name = 'hello'; // ğŸ‘Œ ?!

test = {}; // Cannot assign to 'test' because it is a constant.
```

å½“constå®šä¹‰çš„æ˜¯å¼•ç”¨ç±»å‹æ•°æ®, å®é™…ä¸Šä¿å­˜çš„æ˜¯å¼•ç”¨ç±»å‹çš„æŒ‡é’ˆä¿¡æ¯, å¯¹è±¡å†…éƒ¨çš„å±æ€§çš„å€¼çš„æ”¹å˜æ˜¯è¢«å…è®¸çš„, å¼•ç”¨å‘ç”Ÿå˜åŒ–åˆ™æ˜¯ä¸å…è®¸çš„.



